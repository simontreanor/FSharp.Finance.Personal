# FSharp.Finance.Personal

# Changelog

## [Unreleased]

- Planned: Add payment mapping to match scheduled and actual payments

---

## [2.5.5] - 2025-06-05

### Fixed

- Reverting some of the changes made in 2.5.2, which sought to eliminate discrepancies caused by small amounts of interest at the end of a schedule.
The problem was misidentified as being due to interest/principal forgiveness whereas it was actually caused by unusual edge case of having over-refunded
the customer. A solution has now been implemented by introducing a new balance status `OverRefunded` to describe precisely this scenario and prevent any
interest being accrued from this point on in a schedule, as the resulting positive balance is not the fault of the customer.

---

## [2.5.4] - 2025-06-04

### Fixed

- The Window field of the amortisation schedule was generated by incrementing the window value each time a scheduled payment was due. This has now been
modified to use a map of unit periods instead. This is more useful when projecting schedules beyond their original settlement date, and will be useful
in future updates to support payment mapping. The original purpose of the window was to help analyse payment status (e.g. early/late) but is rather
crude and will be replaced with more accurate mapping.

---

## [2.5.3] - 2025-06-04

### Fixed

- When using a maximum duration rather than a payment count to generate a payment schedule based on a
unit-period config, it was using approximations of the number of payments within a particular timeframe
rather than calculating precisely. This now calculates precisely.

---

## [2.5.2] - 2025-06-02

### Fixed

- Fixed an issue with amortisation where new interest was applied even though a small principal balance had been forgiven. Essentially any principal balance
with a cent value of less than the number of scheduled payments is forgiven and the balance closed. This is to avoid situations where there was an intent to
settle a balance but the payment was very slightly less than the settlement figure, e.g. due to small rounding errors in manual settlement or refund
calculations. Over time, this could lead to disproportionate amounts of interest being charged. With the principal balance being forgiven, there was no need
to calculate and apply any new interest, and this has now been rectified. Relevant unit test:
[ActualPaymentTestExtra008](https://simontreanor.dev/FSharp.Finance.Personal/content/ActualPayment/ActualPaymentTestExtra008.html).

## [2.5.1] - 2025-05-27

### Migration Guide

- `UnitPeriod.Single` is no longer a valid config
- `RegularSchedule` is now `AutoGenerateSchedule`, and the `ScheduleLength` is either a payment count or a maximum length, but not both
- The `Simple` interest method is now `Actuarial`
- `Parameters` has been split into `Basic` and `Advanced`, with only Basic required for basic schedules but both required for full amortisation schedules
- Schedules are now represented as maps with the offset day as the key
- There is now `PaymentQuote.Apportionment` giving a full breakdown of charges, interest, fees and principal
- HTML output is now handled much better, with the option to provide a description for the output, and column visibility is now automatic

---

## [1.3.5] - 2024-09-18

- This version is the final 1.x.x release.
